<!DOCTYPE html>
<html lang="pt-BR">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta
            http-equiv="Content-Security-Policy"
            content="default-src 'self'; script-src 'self' 'unsafe-inline'; style-src 'self' 'unsafe-inline'"
        />
        <title>Celidone - Cadastro de Clientes</title>
        <link rel="stylesheet" href="../../app/shared/styles/utilities.css" />
        <link rel="stylesheet" href="../../app/shared/styles/components.css" />

        <!-- Hot Reload Script para desenvolvimento -->
        <script>
            if (
                location.hostname === "localhost" ||
                location.hostname === "127.0.0.1"
            ) {
                console.log("Hot reload ativo para desenvolvimento");

                // Verifica mudanças nos arquivos CSS
                setInterval(() => {
                    const links = document.querySelectorAll(
                        'link[rel="stylesheet"]'
                    );
                    links.forEach((link) => {
                        const href = link.href;
                        const newHref = href.includes("?")
                            ? href.split("?")[0] + "?t=" + Date.now()
                            : href + "?t=" + Date.now();
                        if (link.href !== newHref) {
                            link.href = newHref;
                        }
                    });
                }, 1000);

                // Listener para recarregar quando arquivos JS mudarem
                // (Requer implementação no processo principal do Electron)
                if (window.electronAPI && window.electronAPI.onFileChange) {
                    window.electronAPI.onFileChange(() => {
                        console.log("Arquivo modificado, recarregando...");
                        location.reload();
                    });
                }
            }
        </script>
    </head>
    <body class="bg-secondary">
        <div class="container py-1">
            <header class="text-center mb-2">
                <h1 class="text-3xl font-bold text-primary mb-1">
                    Cadastro de Clientes
                </h1>
                <p class="text-base text-secondary">
                    Gerencie informações dos seus clientes
                </p>
            </header>

            <main>
                <div class="card">
                    <div class="card-header">
                        <h2 class="card-title">Novo Cliente</h2>
                    </div>
                    <div class="card-body">
                        <form id="form-cliente" class="form">
                            <!-- Linha 1: Natureza, CPF/CNPJ, Código -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="natureza"
                                        >Natureza *</label
                                    >
                                    <select
                                        id="natureza"
                                        name="natureza"
                                        class="form-select"
                                        required
                                    >
                                        <option value="">Selecione</option>
                                        <option value="pessoa_fisica">
                                            Pessoa Física
                                        </option>
                                        <option value="pessoa_juridica">
                                            Pessoa Jurídica
                                        </option>
                                    </select>
                                </div>
                                <div id="campo-cpf" class="form-group hidden">
                                    <label class="form-label" for="cpf"
                                        >CPF *</label
                                    >
                                    <input
                                        type="text"
                                        id="cpf"
                                        name="cpf"
                                        class="form-input"
                                        placeholder="000.000.000-00"
                                        maxlength="14"
                                    />
                                    <div
                                        id="cpf-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                                <div id="campo-cnpj" class="form-group hidden">
                                    <label class="form-label" for="cnpj"
                                        >CNPJ *</label
                                    >
                                    <input
                                        type="text"
                                        id="cnpj"
                                        name="cnpj"
                                        class="form-input"
                                        placeholder="00.000.000/0000-00"
                                        maxlength="18"
                                    />
                                    <div
                                        id="cnpj-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="codigo"
                                        >Código</label
                                    >
                                    <input
                                        type="text"
                                        id="codigo"
                                        name="codigo"
                                        class="form-input"
                                        placeholder="Código do cliente"
                                        readonly
                                    />
                                    <div class="form-help">
                                        Gerado automaticamente
                                    </div>
                                </div>
                            </div>

                            <!-- Linha 2: Nome e Data de Nascimento -->
                            <div class="form-row">
                                <div class="form-group large">
                                    <label class="form-label" for="nome"
                                        >Nome Completo *</label
                                    >
                                    <input
                                        type="text"
                                        id="nome"
                                        name="nome"
                                        class="form-input"
                                        placeholder="Nome completo"
                                        required
                                    />
                                    <div
                                        id="nome-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                                <div class="form-group">
                                    <label
                                        class="form-label"
                                        for="dataNascimento"
                                        >Data de Nascimento *</label
                                    >
                                    <input
                                        type="date"
                                        id="dataNascimento"
                                        name="dataNascimento"
                                        class="form-input"
                                        required
                                    />
                                    <div
                                        id="dataNascimento-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                            </div>

                            <!-- Linha 3: CEP, Buscar e Endereço -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="cep"
                                        >CEP *</label
                                    >
                                    <input
                                        id="cep"
                                        name="cep"
                                        type="text"
                                        class="form-input"
                                        placeholder="00000-000"
                                        maxlength="9"
                                        required
                                    />
                                    <div
                                        id="cep-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                                <div class="form-group">
                                    <div style="height: 24px"></div>
                                    <button
                                        id="buscar-cep-btn"
                                        class="btn btn-secondary"
                                        type="button"
                                    >
                                        Buscar CEP
                                    </button>
                                </div>
                                <div class="form-group large">
                                    <label class="form-label" for="endereco"
                                        >Endereço *</label
                                    >
                                    <input
                                        type="text"
                                        id="endereco"
                                        name="endereco"
                                        class="form-input"
                                        placeholder="Rua, Avenida, etc."
                                        required
                                    />
                                    <div
                                        id="endereco-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                            </div>

                            <!-- Linha 4: Número, Cidade, Bairro -->
                            <div class="form-row">
                                <div class="form-group small">
                                    <label class="form-label" for="numero"
                                        >Número *</label
                                    >
                                    <input
                                        type="text"
                                        id="numero"
                                        name="numero"
                                        class="form-input"
                                        placeholder="123"
                                        required
                                    />
                                    <div
                                        id="numero-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="cidade"
                                        >Cidade *</label
                                    >
                                    <input
                                        type="text"
                                        id="cidade"
                                        name="cidade"
                                        class="form-input"
                                        placeholder="Sua cidade"
                                        required
                                    />
                                    <div
                                        id="cidade-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="bairro"
                                        >Bairro *</label
                                    >
                                    <input
                                        type="text"
                                        id="bairro"
                                        name="bairro"
                                        class="form-input"
                                        placeholder="Seu bairro"
                                        required
                                    />
                                    <div
                                        id="bairro-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                            </div>

                            <!-- Linha 5: Complemento e UF -->
                            <div class="form-row">
                                <div class="form-group large">
                                    <label class="form-label" for="complemento"
                                        >Complemento</label
                                    >
                                    <input
                                        type="text"
                                        id="complemento"
                                        name="complemento"
                                        class="form-input"
                                        placeholder="Apto, Bloco, etc."
                                    />
                                    <div class="form-help">Opcional</div>
                                </div>
                                <div class="form-group small">
                                    <label class="form-label" for="uf"
                                        >UF *</label
                                    >
                                    <input
                                        type="text"
                                        id="uf"
                                        name="uf"
                                        class="form-input"
                                        placeholder="SP"
                                        maxlength="2"
                                        required
                                        style="text-transform: uppercase"
                                    />
                                    <div
                                        id="uf-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                            </div>

                            <!-- Linha 6: Email -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="email"
                                        >Email *</label
                                    >
                                    <input
                                        type="email"
                                        id="email"
                                        name="email"
                                        class="form-input"
                                        placeholder="cliente@exemplo.com"
                                        required
                                    />
                                    <div
                                        id="email-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                            </div>

                            <!-- Linha 7: Telefones -->
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label" for="celular"
                                        >Celular *</label
                                    >
                                    <input
                                        type="text"
                                        id="celular"
                                        name="celular"
                                        class="form-input"
                                        placeholder="(00) 00000-0000"
                                        maxlength="15"
                                        required
                                    />
                                    <div
                                        id="celular-error"
                                        class="form-error hidden"
                                    ></div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label" for="telefoneFixo"
                                        >Telefone Fixo</label
                                    >
                                    <input
                                        type="text"
                                        id="telefoneFixo"
                                        name="telefoneFixo"
                                        class="form-input"
                                        placeholder="(00) 0000-0000"
                                        maxlength="14"
                                    />
                                    <div class="form-help">Opcional</div>
                                </div>
                            </div>

                            <!-- Mensagem de erro geral -->
                            <div id="error-message" class="hidden mt-1">
                                <div class="notification notification-error">
                                    <div class="notification-content">
                                        <div
                                            class="notification-message"
                                            id="error-text"
                                        ></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Botões de ação -->
                            <div class="form-actions">
                                <button type="submit" class="btn btn-primary">
                                    Cadastrar Cliente
                                </button>
                                <button
                                    type="button"
                                    id="listar-clientes-btn"
                                    class="btn btn-secondary"
                                >
                                    Listar Clientes
                                </button>
                                <button
                                    type="button"
                                    class="btn btn-ghost"
                                    onclick="this.form.reset()"
                                >
                                    Limpar Formulário
                                </button>
                            </div>
                        </form>
                    </div>
                </div>

                <!-- Seção de Lista de Clientes -->
                <div class="card mt-2">
                    <div class="card-header">
                        <h2 class="card-title">Lista de Clientes</h2>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-striped">
                                <thead>
                                    <tr>
                                        <th>ID</th>
                                        <th>Tipo</th>
                                        <th>Nome</th>
                                        <th>Data Nasc.</th>
                                        <th>CEP</th>
                                        <th>Endereço</th>
                                        <th>Número</th>
                                        <th>Cidade</th>
                                        <th>Bairro</th>
                                        <th>Complemento</th>
                                        <th>UF</th>
                                        <th>Email</th>
                                        <th>Celular</th>
                                        <th>Telefone Fixo</th>
                                        <th>Ações</th>
                                    </tr>
                                </thead>
                                <tbody id="cliente-lista">
                                    <tr>
                                        <td
                                            colspan="15"
                                            class="text-center py-1 text-muted"
                                        >
                                            Nenhum cliente carregado. Clique em
                                            "Listar Clientes" para carregar.
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </main>
        </div>

        <!-- Loading overlay -->
        <div id="loading-overlay" class="loading-overlay hidden">
            <div class="loading-spinner"></div>
        </div>

        <!-- Notification container -->
        <div id="notification-container" class="notification-container"></div>

        <!-- Importa o módulo de cliente -->
        <script
            type="module"
            src="../../app/modules/cliente/ClienteController.js"
        ></script>
    </body>
</html>
